<!DOCTYPE html>
<html>
  <head>
    <title>Hermant®</title>

    <!-- Viewport mobile tag for sensible mobile support -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <%/* If you want to discourage search engines from indexing this site, uncomment the following line: */%>
    <%/* <meta name="robots" content="noindex"> */%>

    <!--link rel="icon" href="/assets/favicon.png" type="image/png"-->
    <!--
        Stylesheets and Preprocessors
        ==============================

        You can always bring in CSS files manually with `<link>` tags, or asynchronously
        using a solution like AMD (RequireJS).  Or, if you like, you can take advantage
        of Sails' conventional asset pipeline (boilerplate Gruntfile).

        By default, stylesheets from your `assets/styles` folder are included
        here automatically (between STYLES and STYLES END). Both CSS (.css) and LESS (.less)
        are supported. In production, your styles will be minified and concatenated into
        a single file.

        To customize any part of the built-in behavior, just edit `tasks/pipeline.js`.
        For example, here are a few things you could do:

            + Change the order of your CSS files
            + Import stylesheets from other directories
            + Use a different or additional preprocessor, like SASS, SCSS or Stylus
    -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://unpkg.com/gijgo@1.9.11/css/gijgo.min.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.2/fullcalendar.min.css">
    <link rel="stylesheet" href="https://fullcalendar.io/releases/fullcalendar/3.10.0/fullcalendar.min.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">



    <!--STYLES-->
    <link rel="stylesheet" href="/styles/importer.css">
    <!--STYLES END-->
  </head>

  <body>
    <nav class="navbar navbar-expand-sm navbar-dark bg-primary mb-4">
      <a class="navbar-brand" href="/"><b>HERMANT®</b> <i>Control de Mantenimientos</i></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Obras
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/obra/lista">Lista de Obras</a>
            <a class="dropdown-item" href="/obra/add">Nueva Obra</a>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Equipos
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/maquina/lista">Lista de Equipos</a>
            <a class="dropdown-item" href="/maquina/add">Nuevo Equipo</a>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Repuestos
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/pieza/lista">Lista de Repuestos</a>
            <a class="dropdown-item" href="/pieza/add">Nuevo Repuesto</a>
          </div>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Opciones
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="#">Iniciar Sesion</a>
            <a class="dropdown-item" href="#">Perfil</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Cerrar Sesion</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container-fluid">
    <%- body %>
  </div>






    <!--SCRIPTS-->
    <script src="/dependencies/sails.io.js"></script>
    <!--SCRIPTS END-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>


    <!--link rel='stylesheet' href='fullcalendar/fullcalendar.css' type="text/javascript" />
    <script src='lib/jquery.min.js' type="text/javascript"></script>
    <script src='lib/moment.min.js' type="text/javascript"></script>
    <script src='fullcalendar/fullcalendar.js' type="text/javascript"></script>
    <script src='fullcalendar/locale/es.js' type="text/javascript"></script>
    <script src='fullcalendar/lang/es.js' type="text/javascript"></script-->

    <script src='https://fullcalendar.io/releases/fullcalendar/3.10.0/lib/moment.min.js' type="text/javascript"></script>
    <script src='https://fullcalendar.io/releases/fullcalendar/3.10.0/lib/jquery.min.js' type="text/javascript"></script>
    <script src='https://fullcalendar.io/releases/fullcalendar/3.10.0/fullcalendar.min.js' type="text/javascript"></script>


    <!--link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css"-->
    <!--script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script-->
    <!--script src="//code.jquery.com/jquery-1.11.1.min.js"></script-->

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://unpkg.com/gijgo@1.9.11/js/gijgo.min.js" type="text/javascript"></script>




    <!-- Script para el campo del formulario dinamico-->
    <script type="text/javascript">
      $(function() {
          // Remove button click
          $(document).on(
              'click',
              '[data-role="dynamic-fields"] > .form-inline [data-role="remove"]',
              function(e) {
                var num = $('.clonedInput').length;
                var newNum = num - 1;
                e.preventDefault();
                var container = $(this).closest('[data-role="dynamic-fields"]');
                var container2 = $(this).closest('[data-name="group-dyn"]');
                container2.children().filter('.inputCant').attr('value', newNum);
                $(this).closest('.form-inline').remove();
              }
          );
          // Add button click
          $(document).on(
              'click',
              '[data-role="dynamic-fields"] > .form-inline [data-role="add"]',
              function(e) {
                var num = $('.clonedInput').length;
                var newNum = num + 1;
                e.preventDefault();
                var container = $(this).closest('[data-role="dynamic-fields"]');
                new_field_group = container.children().filter('.form-inline').clone();
                new_field_group.find('input').each(function(){
                    $(this).val('');
                });
                var container3 = $(this).closest('[data-role="campos-variables"]');
                container3.children().filter('.clonedInput:first-child').children().attr('name', 'rep'+newNum);
                var container4 = $(this).closest('[data-role="precio-input"]');

                //container3.children().filter('.precio-input').children().filter('.campo-precio').attr('name', 'precio'+newNum);
                container4.children().filter('.campo-precio').attr('name', 'precio'+newNum);
                console.log(container4.children().filter('.campo-precio').attr('name'));

                //console.log(container3.children().filter('.precio-input').children().filter('.campo-precio').attr('name'));
                //container.children().filter('.form-inline').children().filter('.clonedInput:first-child').children().attr('name', 'rep'+newNum);
                //container.children().filter('.form-inline').children().filter('.precioInput:first-child').children().attr('name', 'precio'+newNum);
                //console.log(container.children().filter('.form-inline').children().filter('.precioInput:first-child').children().attr('name'));

                var container2 = $(this).closest('[data-name="group-dyn"]');
                container2.children().filter('.inputCant').attr('value', newNum);
                container.append(new_field_group);
              }
          );
      });
    </script>

    <!-- Script para el datepicker para seleccionar una fecha de mantenimiento -->
    <script>
        $('#datepicker').datepicker({
          format: 'dd-mm-yyyy',
          uiLibrary: 'bootstrap4',
          minDate: function() {
            var date = new Date();
            date.setDate(date.getDate()-4);
            return new Date(date.getFullYear(), date.getMonth(), date.getDate());
          },

          toDisplay: function (date, format, language) {
              var d = new Date(date);
              d.setDate(d.getDate() - 7);
              return d.toISOString();
          },
        });
    </script>

    <!-- Script para rellenar los selectores de los repuestos dinamicamente-->
    <script>
      $("#repuesto").change(function() {

        var $dropdown = $(this);
        var key = $dropdown.val();
        var $secondChoice = $("#tipoDeRepuesto");
        $secondChoice.empty();

        switch(key) {
          case 'Filtro':
            $secondChoice.append("<option>" + "Aceite Motor" + "</option>");
            $secondChoice.append("<option>" + "Aire" + "</option>");
            $secondChoice.append("<option>" + "Aceite Hidraulico" + "</option>");
            $secondChoice.append("<option>" + "Combustible" + "</option>");
            break;
          case 'Aceite':
            $secondChoice.append("<option>" + "Motor" + "</option>");
            $secondChoice.append("<option>" + "Hidraulico" + "</option>");
            $secondChoice.append("<option>" + "Diferencial" + "</option>");
            $secondChoice.append("<option>" + "Transmision" + "</option>");
            $secondChoice.append("<option>" + "Mandos Finales" + "</option>");
            break;
          case 'Liquido':
            $secondChoice.append("<option>" + "Refrigerante" + "</option>");
            $secondChoice.append("<option>" + "Freno" + "</option>");
            break;
          case 'base':
            vals = ['Please choose from above'];
        }

        /*$.ajax({
            url: '/jsonData/repuestos.json',
            dataType: 'json',
            success: function(data) {
                var key = $dropdown.val();
                var vals = [];
                var $secondChoice = $("#tipoDeRepuesto");
                $secondChoice.empty();
                console.log("Antes del Switch");

                switch(key) {
                  case 'Filtro':
                    vals = data.Filtros.split(",");
                    break;
                  case 'Aceite':
                    vals = data.Aceites.split(",");
                    break;
                  case 'Liquido':
                    vals = data.Liquidos.split(",");
                    break;
                  case 'base':
                    vals = ['Please choose from above'];
                }


                $.each(vals, function(index, value) {
                  $secondChoice.append("<option>" + value + "</option>");
                });
            }
        });*/

        /*$.getJSON("../assets/jsonData/repuestos.json", function(data) {

          var key = $dropdown.val();
          var vals = [];

          switch(key) {
            case 'Filtros':
              vals = data.Filtros.split(",");
              break;
            case 'Aceites':
              vals = data.Aceites.split(",");
              break;
            case 'Liquidos':
              vals = data.Liquidos.split(",");
              break;
            case 'base':
              vals = ['Please choose from above'];
          }

          var $secondChoice = $("#tipoDeRepuesto");
          $secondChoice.empty();
          $.each(vals, function(index, value) {
            $secondChoice.append("<option>" + value + "</option>");
          });
        });*/
      });
    </script>

    <script>
      $(function () {
        //$('[data-toggle="tooltip"]').tooltip()
      })
    </script>

    <!-- Script para el modal de eliminar -->
    <script>
      $('#eliminarModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var id = button.data('id') // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        console.log('hola');
        var modal = $(this)
        modal.find('.modal-title').text(id);
        //modal.find('.modal-footer form').action.("/mantenimiento/delete/" + id)
      })
    </script>

    <!-- Script para el filtro de las tablas -->
    <script>
      $(document).ready(function(){

        //var idBusqueda = "#filtrar" +

        //var idTabla = "#tabla" +

        $("#filtrar").on("keyup", function() {
          var value = $(this).val().toLowerCase();
          $("#tabla tr").filter(function() {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
          });
        });
      });
    </script>

    <script>
      $(document).ready(function(){
        $('.filterable .btn-filter').click(function(){
            var $panel = $(this).parents('.filterable'),
            $filters = $panel.find('.filters input'),
            $tbody = $panel.find('.table tbody');
            if ($filters.prop('disabled') == true) {
                $filters.prop('disabled', false);
                $filters.first().focus();
            } else {
                $filters.val('').prop('disabled', true);
                $tbody.find('.no-result').remove();
                $tbody.find('tr').show();
            }
        });

          $('.filterable .filters input').keyup(function(e){
              /* Ignore tab key */
              var code = e.keyCode || e.which;
              if (code == '9') return;
              /* Useful DOM data and selectors */
              var $input = $(this),
              inputContent = $input.val().toLowerCase(),
              $panel = $input.parents('.filterable'),
              column = $panel.find('.filters th').index($input.parents('th')),
              $table = $panel.find('.table'),
              $rows = $table.find('tbody tr');
              /* Dirtiest filter function ever ;) */
              var $filteredRows = $rows.filter(function(){
                  var value = $(this).find('td').eq(column).text().toLowerCase();
                  return value.indexOf(inputContent) === -1;
              });
              /* Clean previous no-result if exist */
              $table.find('tbody .no-result').remove();
              /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
              $rows.show();
              $filteredRows.hide();
              /* Prepend no-result row if all rows are filtered */
              if ($filteredRows.length === $rows.length) {
                  $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No result found</td></tr>'));
              }
          });
      });
    </script>

  <!-- Scripts para el calendario -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <!--script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" type="text/javascript"></script-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.2/fullcalendar.min.js" type="text/javascript"></script>
    <script>
      $(document).ready(function() {

        $('#calendar').fullCalendar({
          themeSystem: 'bootstrap4',
          header: { left: 'today',
                    center: 'title',
                    right: 'prev,next'},
          locale: 'es',
          lang: 'es',
          dayNames:['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado'],
          dayNamesShort: ['Dom','Lun','Mar','Mie','Jue','Vie','Sáb'],
          monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
          monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
          views: {
            month: { // name of view
              titleFormat: 'MMMM YYYY'
              // other view-specific options here
            }
          },
          weekends: true,
          //dayClick: function() {
          //  alert('a day has been clicked!');
          //},

          defaultView: 'month',

          events:[
            {
              title: 'Mantenimiento Maquina 1',
              start: '2019-02-07',
              url: '/maquina/ver/5c252474398769af7a440f72/',
            },
            {
              title: 'Mantenimiento Maquina 2',
              start: '2019-02-12',
              allDay: true,
              url: '/maquina/ver/5c4b5fe1b7cc787f3cc2e137/',
            },
            {
              title: 'Mantenimiento Maquina 3',
              start: '2019-02-15',
              allDay: true,
            },
          ]

        });

      });
    </script>
    <script>
      $(document).ready(function () {
        $('#calendar').fullCalendar('updateEvents',
          [
            {
              title: 'Mantenimiento Maquina 4',
              start: '2019-02-09',
              url: '/maquina/ver/5c252474398769af7a440f72/',
            },
            {
              title: 'Mantenimiento Maquina 5',
              start: '2019-02-13',
              allDay: true,
              url: '/maquina/ver/5c4b5fe1b7cc787f3cc2e137/',
            },
            {
              title: 'Mantenimiento Maquina 6',
              start: '2019-02-19',
              allDay: true,
            },
          ]
        );

      });
    </script>



  </body>
</html>
